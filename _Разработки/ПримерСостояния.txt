&НаКлиенте
Процедура Выгрузить(Команда)
	
	Если НЕ ПроверитьЗаполнение() Тогда
		Возврат;
	КонецЕсли;
	
	Состояние("Начало обработки данных",25);
	РезультатВыгрузки = ВыгрузитьСервер();
	Состояние("Обработка данных",35);
	
	Если ПустаяСтрока(РезультатВыгрузки) Тогда
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не указаны значения выгрузки!",,"Дерево");
		Состояние("Ошибка обработки данных",35);
		Возврат;
		
	КонецЕсли;
	
	Состояние("Получение данных",50);
	
	АрхивДвоичныеДанные = ПолучитьИзВременногоХранилища(РезультатВыгрузки);
	ИмяФайлаАрхива = ПолучитьИмяВременногоФайла("zip");
	АрхивДвоичныеДанные.Записать(ИмяФайлаАрхива);
	Архив = Новый ЧтениеZipФайла(ИмяФайлаАрхива); 
	Попытка
	    Архив.ИзвлечьВсе(Файл, РежимВосстановленияПутейФайловZIP.НеВосстанавливать);
	Исключение
	    ВызватьИсключение "Нет доступа к каталогу";
	КонецПопытки;	
	
	Состояние("Сохранение данных",70);
	СобратьФайлы(ТаблицаФайлов);
	Состояние("Обработка данных завершена",100);
	
КонецПроцедуры


	
	ПодборМеста();
	
	
		СтандартнаяОбработка = Ложь;
	
	Если Не ЗначениеЗаполнено(Объект.Помещение) Тогда
		Элементы.Место.ТолькоПросмотр = Ложь; 
		Элементы.Место.СписокВыбора.ЗагрузитьЗначения(ИспользуемыеПомещения.ВыгрузитьЗначения()); 
	КонецЕсли;

