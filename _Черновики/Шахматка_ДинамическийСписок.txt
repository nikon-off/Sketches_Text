ВЫБРАТЬ
	ОбъектыНедвижимости.Район КАК Район,
	ОбъектыНедвижимости.Объект КАК Объект,
	ОбъектыНедвижимости.Секция КАК Секция,
	ОбъектыНедвижимости.Этаж КАК Этаж,
	ОбъектыНедвижимости.НомерНаЭтаже КАК НомерНаЭтаже,
	ОбъектыНедвижимости.Ссылка КАК ОбъектНедвижимости,
	ВЫБОР
		КОГДА СнятыеКвартирыСПродаж.Актуальность ЕСТЬ NULL
			ТОГДА НедвижимостьСрезПоследних.СтатусНедвижимости
		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.УПДК_СтатусыНедвижимости.НеДляПродажи)
	КОНЕЦ КАК СтатусНедвижимости,
	НедвижимостьСрезПоследних.ЗаказКлиента КАК ЗаказКлиента,
	НедвижимостьСрезПоследних.Клиент КАК Клиент,
	ОбъектыНедвижимости.ВидНедвижимости КАК ВидНедвижимости,
	ОбъектыНедвижимости.ТипНедвижимости КАК ТипНедвижимости,
	ОбъектыНедвижимости.НомерУсловный КАК НомерУсловный,
	ВЫБОР
		КОГДА ПОДСТРОКА(ОбъектыНедвижимости.БалконыСтрокой, 1, 1) = """"
			ТОГДА ОбъектыНедвижимости.ЛоджииСтрокой
		КОГДА ПОДСТРОКА(ОбъектыНедвижимости.ЛоджииСтрокой, 1, 1) = """"
			ТОГДА ОбъектыНедвижимости.БалконыСтрокой
		ИНАЧЕ ПОДСТРОКА(ОбъектыНедвижимости.БалконыСтрокой, 1, 8) + "" + "" + ПОДСТРОКА(ОбъектыНедвижимости.ЛоджииСтрокой, 1, 8)
	КОНЕЦ КАК Балконы,
	ОбъектыНедвижимости.ОбщаяПлощадьПроектная КАК ОбщаяПлощадьПроектная,
	ОбъектыНедвижимости.КоличествоКомнат КАК КоличествоКомнат,
	ОбъектыНедвижимости.ТипПланировки КАК ТипПланировки,
	ОбъектыНедвижимости.ПлощадьКухни КАК ПлощадьКухни,
	ОбъектыНедвижимости.Уровней КАК Уровней,
	ОбъектыНедвижимости.СовмещенныйСанУзел КАК СовмещенныйСанУзел,
	ВЫБОР
		КОГДА НедвижимостьСрезПоследних.Договор <> ЗНАЧЕНИЕ(Документ.РеализацияНедвижимости.ПустаяСсылка)
			ТОГДА НедвижимостьСрезПоследних.Договор.СуммаДокумента
		ИНАЧЕ ЕСТЬNULL(ДокументЗаказКлиента.СуммаДокумента, 0)
	КОНЕЦ КАК СуммаПродажи,
	ОбъектыНедвижимости.НомерБТИ КАК НомерБТИ,
	ОбъектыНедвижимости.ОбщаяПлощадьБТИ КАК ОбщаяПлощадьБТИ,
	ОбъектыНедвижимости.ПлощадьКухниБТИ КАК ПлощадьКухниБТИ,
	ОбъектыНедвижимости.ОбщаяПлощадьПриведенная КАК ОбщаяПлощадьПриведенная,
	ОбъектыНедвижимости.ОбщаяПлощадьПриведеннаяБТИ КАК ОбщаяПлощадьПриведеннаяБТИ,
	НедвижимостьСрезПоследних.Договор.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыДоговоровСПокупателями.Подписан) КАК ДоговорПодписан,
	ОбъектыНедвижимости.Вторичный КАК Вторичный
ПОМЕСТИТЬ ВТОбъектыНедвижимости
ИЗ
	Справочник.УПДК_ОбъектыНедвижимости КАК ОбъектыНедвижимости
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УПДК_РайоныСтроительства КАК РайоныСтроительства
		ПО ОбъектыНедвижимости.Район = РайоныСтроительства.Ссылка
			И (НЕ РайоныСтроительства.Архив)
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УПДК_ОбъектыСтроительства КАК ОбъектыСтроительства
		ПО ОбъектыНедвижимости.Объект = ОбъектыСтроительства.Ссылка
			И (НЕ ОбъектыСтроительства.Архив)
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УПДК_СекцииОбъектов КАК СекцииОбъектов
		ПО (НЕ СекцииОбъектов.Архив)
			И ОбъектыНедвижимости.Владелец = СекцииОбъектов.Ссылка
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УПДК_Недвижимость.СрезПоследних КАК НедвижимостьСрезПоследних
			ЛЕВОЕ СОЕДИНЕНИЕ Документ.УПДК_ЗаказКлиента КАК ДокументЗаказКлиента
			ПО НедвижимостьСрезПоследних.ЗаказКлиента = ДокументЗаказКлиента.Ссылка
		ПО (НедвижимостьСрезПоследних.ОбъектНедвижимости = ОбъектыНедвижимости.Ссылка)
			И (НедвижимостьСрезПоследних.СтатусНедвижимости <> ЗНАЧЕНИЕ(Перечисление.УПДК_СтатусыНедвижимости.НеДляПродажи))
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СнятыеКвартирыСПродаж КАК СнятыеКвартирыСПродаж
		ПО (НедвижимостьСрезПоследних.ОбъектНедвижимости = СнятыеКвартирыСПродаж.ОбъектНедвижимости)
			И (СнятыеКвартирыСПродаж.Актуальность)

ИНДЕКСИРОВАТЬ ПО
	ОбъектНедвижимости,
	ЗаказКлиента
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблОбъектовНедвижимости.Секция КАК Секция,
	ТаблОбъектовНедвижимости.Этаж КАК Этаж,
	ТаблОбъектовНедвижимости.НомерНаЭтаже КАК НомерНаЭтаже,
	ТаблОбъектовНедвижимости.ОбъектНедвижимости КАК ОбъектНедвижимости,
	ТаблОбъектовНедвижимости.ВидНедвижимости КАК ВидНедвижимости,
	ТаблОбъектовНедвижимости.ТипНедвижимости КАК ТипНедвижимости,
	ТаблОбъектовНедвижимости.СтатусНедвижимости КАК СтатусНедвижимости,
	ТаблОбъектовНедвижимости.ЗаказКлиента КАК ЗаказКлиента,
	ЕСТЬNULL(ЗабронированнаяНедвижимостьСрезПоследних.СрокБронирования, ДАТАВРЕМЯ(1, 1, 1)) КАК СрокБронирования,
	ЕСТЬNULL(ЗабронированнаяНедвижимостьСрезПоследних.Бессроночное, ЛОЖЬ) КАК Бессроночное,
	ТаблОбъектовНедвижимости.НомерУсловный КАК НомерПроект,
	ЕСТЬNULL(ВзаиморасчетыОстатки.СуммаОстаток, 0) КАК Долг,
	ТаблОбъектовНедвижимости.СуммаПродажи КАК СуммаПродажи,
	ЕСТЬNULL(ФактическиеЦеныНедвижимости.Цена, 0) КАК Цена,
	ЕСТЬNULL(ФактическиеЦеныНедвижимости.Стоимость, 0) КАК Стоимость,
	ТаблОбъектовНедвижимости.Район КАК Район,
	ТаблОбъектовНедвижимости.Объект КАК Объект,
	ТаблОбъектовНедвижимости.Балконы КАК Балконы,
	ТаблОбъектовНедвижимости.ОбщаяПлощадьПроектная КАК ОбщаяПлощадь,
	ТаблОбъектовНедвижимости.Клиент КАК Клиент,
	ТаблОбъектовНедвижимости.КоличествоКомнат КАК КоличествоКомнат,
	ТаблОбъектовНедвижимости.ТипПланировки КАК ТипПланировки,
	ТаблОбъектовНедвижимости.ПлощадьКухни КАК ПлощадьКухни,
	ТаблОбъектовНедвижимости.Уровней КАК КоличествоУровней,
	ТаблОбъектовНедвижимости.СовмещенныйСанУзел КАК СовмещенныйСанУзел,
	ВЫБОР
		КОГДА ЕСТЬNULL(ОграниченияПродажОстатки.КоличествоОстаток, 0) > 0
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЕстьОграничения,
	ВЫБОР
		КОГДА ТаблОбъектовНедвижимости.СуммаПродажи = 0
			ТОГДА 0
		ИНАЧЕ ЕСТЬNULL(ФактическиеЦеныНедвижимости.Стоимость, 0) - ТаблОбъектовНедвижимости.СуммаПродажи
	КОНЕЦ КАК Отклонение,
	СобственникиОбъектовНедвижимости.Собственник КАК Организация,
	ТаблОбъектовНедвижимости.НомерБТИ КАК НомерБТИ,
	ТаблОбъектовНедвижимости.ОбщаяПлощадьБТИ КАК ОбщаяПлощадьБТИ,
	ТаблОбъектовНедвижимости.ПлощадьКухниБТИ КАК ПлощадьКухниБТИ,
	ТаблОбъектовНедвижимости.ОбщаяПлощадьПриведенная КАК ОбщаяПлощадьПриведенная,
	ТаблОбъектовНедвижимости.ОбщаяПлощадьПриведеннаяБТИ КАК ОбщаяПлощадьПриведеннаяБТИ,
	ТаблОбъектовНедвижимости.ДоговорПодписан КАК ДоговорПодписан
ИЗ
	ВТОбъектыНедвижимости КАК ТаблОбъектовНедвижимости
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УПДК_ЗабронированнаяНедвижимость.СрезПоследних КАК ЗабронированнаяНедвижимостьСрезПоследних
		ПО ТаблОбъектовНедвижимости.ОбъектНедвижимости = ЗабронированнаяНедвижимостьСрезПоследних.ОбъектНедвижимости
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.УПДК_Взаиморасчеты.Остатки КАК ВзаиморасчетыОстатки
		ПО ТаблОбъектовНедвижимости.ЗаказКлиента = ВзаиморасчетыОстатки.ЗаказКлиента
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УПДК_ФактическиеЦеныНедвижимости КАК ФактическиеЦеныНедвижимости
		ПО ТаблОбъектовНедвижимости.ОбъектНедвижимости = ФактическиеЦеныНедвижимости.ОбъектНедвижимости
			И (ФактическиеЦеныНедвижимости.ВидЦены = &ВидЦены)
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УПДК_СобственникиОбъектовНедвижимости.СрезПоследних КАК СобственникиОбъектовНедвижимости
		ПО ТаблОбъектовНедвижимости.ОбъектНедвижимости = СобственникиОбъектовНедвижимости.ОбъектНедвижимости
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.УПДК_ОграниченияПродаж.Остатки(, ВидОграничения.УровеньОграниченияПродажи.Порядок <= &ИндексИнформировать) КАК ОграниченияПродажОстатки
		ПО ТаблОбъектовНедвижимости.ОбъектНедвижимости = ОграниченияПродажОстатки.ОбъектНедвижимости